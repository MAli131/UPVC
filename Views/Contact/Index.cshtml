@model UPVC.ViewModels.ContactViewModel
@using Microsoft.Extensions.Localization
@using System.Globalization
@using UPVC.Models
@inject IStringLocalizer<UPVC.Resources.ContactPageResource> ContactLocalizer
@inject IStringLocalizer<UPVC.Resources.SharedResource> SharedLocalizer
@{
    ViewData["Title"] = "Contact";
    ViewData["UseGreenNavbar"] = true;
    ViewData["ShowNavbar"] = true;
    var isArabic = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
}

<section class="hero-section contact-section">
    <div class="container">
        <div class="row row-cols-1 row-cols-lg-2">
            <div class="hero-content col">
                <h1 class="hero-title">
                        @(isArabic ? Model?.ContactPage?.TitleAr : Model?.ContactPage?.TitleEn)
                </h1>
                <p class="hero-description">
                    @(isArabic 
                        ? (Model?.ContactPage?.SubtitleAr ?? "سواء كانت لديك أي استفسارات حول منتجاتنا أو كنت تفكر في تقديم طلب،")
                        : (Model?.ContactPage?.SubtitleEn ?? "Whether you have any questions regarding our products or you're considering making an order,"))
                    @if (!string.IsNullOrEmpty(Model?.ContactPage?.SubtitleHighlightEn) || !string.IsNullOrEmpty(Model?.ContactPage?.SubtitleHighlightAr))
                    {
                        <span>
                            @(isArabic 
                                ? (Model?.ContactPage?.SubtitleHighlightAr ?? "لا تتردد في الاتصال بنا.") 
                                : (Model?.ContactPage?.SubtitleHighlightEn ?? "feel free to contact us."))
                        </span>
                    }
                </p>
                @if (!string.IsNullOrEmpty(Model?.ContactPage?.ContentEn) || !string.IsNullOrEmpty(Model?.ContactPage?.ContentAr))
                {
                    <p class="hero-description">
                        @(isArabic 
                            ? (Model?.ContactPage?.ContentAr ?? "مصنع نوافذ، موزع، مهندس معماري، صاحب منزل، مهما كانت فئتك،")
                            : (Model?.ContactPage?.ContentEn ?? "Window manufacturer, Supplier, Architect, Home owner, no matter what your category is,"))
                        @if (!string.IsNullOrEmpty(Model?.ContactPage?.ContentHighlightEn) || !string.IsNullOrEmpty(Model?.ContactPage?.ContentHighlightAr))
                        {
                            <span>
                                @(isArabic 
                                    ? (Model?.ContactPage?.ContentHighlightAr ?? "يسعدنا دعمك.") 
                                    : (Model?.ContactPage?.ContentHighlightEn ?? "we would be glad to support you."))
                            </span>
                        }
                    </p>
                }

                <div class="hero-category">
                    <label for="category" class="form-label">@(isArabic ? "اختر الفئة" : "Select Category")</label>
                    <select class="form-select" id="category" name="CategorySelect" required onchange="setCategoryData(this)">
                            <option value="" disabled selected>@(isArabic ? "اختر..." : "Choose...")</option>
                        @if (Model?.Categories != null && Model.Categories.Any())
                        {
                            foreach (var category in Model.Categories)
                            {
                                    <option value="@category.Id" data-name="@(isArabic ? category.NameAr : category.NameEn)">@(isArabic ? category.NameAr : category.NameEn)</option>
                            }
                        }
                        else
                        {
                            <option value="1" data-name="Window manufacturer (Egypt)">Window manufacturer (Egypt)</option>
                            <option value="2" data-name="Supplier">Supplier</option>
                            <option value="3" data-name="Architect">Architect</option>
                            <option value="4" data-name="Home owner">Home owner</option>
                            <option value="5" data-name="Other">Other</option>
                        }
                    </select>
                    <span asp-validation-for="NewMessage.Category" class="text-danger"></span>
                </div>
            </div>
            <div class="hero-form col">
                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert" id="successAlert">
                        @TempData["SuccessMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }
                @if (TempData["ErrorMessage"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert" id="errorAlert">
                        @TempData["ErrorMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }
                <form class="row" asp-action="Index" asp-controller="Contact" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="categoryId" name="CategoryId" />
                    <input type="hidden" id="categoryName" name="Category" />
                    <div class="col-12 col-md-5">
                        <input type="text" class="form-control" id="name" placeholder="@(isArabic ? "الاسم" : "Name")" asp-for="NewMessage.Name" required>
                        <span asp-validation-for="NewMessage.Name" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-7">
                        <input type="email" class="form-control" id="email" placeholder="@(isArabic ? "البريد الإلكتروني" : "Email")" asp-for="NewMessage.Email" required>
                        <span asp-validation-for="NewMessage.Email" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-4">
                            <input type="text" class="form-control" id="country" placeholder="@(isArabic ? "الدولة" : "Country")" asp-for="NewMessage.Country" required>
                            <span asp-validation-for="NewMessage.Country"></span>
                    </div>
                    <div class="col-12 col-md-4">
                        <input type="text" class="form-control" id="city" placeholder="@(isArabic ? "المدينة" : "City")" asp-for="NewMessage.City">
                    </div>
                    <div class="col-12 col-md-4">
                        <input type="tel" class="form-control" id="tel" placeholder="@(isArabic ? "الهاتف" : "Telephone")" asp-for="NewMessage.Telephone">
                    </div>
                    <div class="col-12">
                        <textarea class="form-control" id="message" rows="5" placeholder="@(isArabic ? "الرسالة" : "Message")" asp-for="NewMessage.Content"></textarea>
                       
                    </div>
                    <div>
                            <button type="submit" class="btn btn-primary">
                                @(isArabic ? "إرسال" : "Send")
                            <svg width="16" height="16" viewBox="0 0 25 19" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M0 0V18.1106H24.1475V0H0ZM21.6502 2.01229L12.0737 9.77268L2.49725 2.01229H21.6502ZM2.01229 16.0983V4.2087L12.0737 12.3625L22.1352 4.2087V16.0983H2.01229Z"
                                    fill="white" />
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div class="hero-footer">
            <div class="hero-address">
                @if (Model?.CompanyInfo != null)
                {
                    <p>
                      <span>@(isArabic?Model.CompanyInfo.AddressAr :Model.CompanyInfo.AddressEn)</span>
                    </p>
                    <p>
                        @Model.CompanyInfo.Mobile <br>
                        @Model.CompanyInfo.Email
                    </p>
                }

                <ul>
                    @{
                        var facebook = Model?.SocialMedias?.FirstOrDefault(s => s.Platform == SocialMediaPlatform.Facebook);
                        var instagram = Model?.SocialMedias?.FirstOrDefault(s => s.Platform == SocialMediaPlatform.Instagram);
                        var linkedin = Model?.SocialMedias?.FirstOrDefault(s => s.Platform == SocialMediaPlatform.LinkedIn);
                    }
                    
                    <li>
                        <a href="@(facebook?.Url ?? "#")" target="_blank" rel="noopener noreferrer">
                            <img src="/images/contact/facebook.png" alt="facebook" width="30px" loading="lazy">
                        </a>
                    </li>
                    
                    <li>
                        <a href="@(instagram?.Url ?? "#")" target="_blank" rel="noopener noreferrer">
                            <img src="/images/contact/instagram.png" alt="instagram" width="30px" loading="lazy">
                        </a>
                    </li>
                    
                    <li>
                        <a href="@(linkedin?.Url ?? "#")" target="_blank" rel="noopener noreferrer">
                            <img src="/images/contact/linkedin.png" alt="linkedin" width="30px" loading="lazy">
                        </a>
                    </li>
                </ul>
                @if (Model?.CompanyInfo != null)
                {
                    <div class="hotline">
                        <span class="hotline-number">@Model.CompanyInfo.Phone</span>
                        <p class="ms-1">@(isArabic ? "الخط الساخن" : "Hotline")</p>
                    </div>
                }
               
            </div>
            <p>
                &copy;
                <script>
                    document.write(new Date().getFullYear());
                </script>
                @if (Model?.CompanyInfo != null)
                {
                    @(isArabic ? Model.CompanyInfo.CopyrightTextAr : Model.CompanyInfo.CopyrightTextEn)
                }
            </p>
        </div>
    </div>
</section>

@section Scripts {
    <script src="~/js/lang.js"></script>
    <script>
        function setCategoryData(selectElement) {
            var selectedOption = selectElement.options[selectElement.selectedIndex];
            var categoryId = selectedOption.value;
            var categoryName = selectedOption.getAttribute('data-name');
            
            document.getElementById('categoryId').value = categoryId;
            document.getElementById('categoryName').value = categoryName;
        }

        // Auto-hide success and error messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            var successAlert = document.getElementById('successAlert');
            var errorAlert = document.getElementById('errorAlert');
            
            if (successAlert) {
                setTimeout(function() {
                    var bsAlert = new bootstrap.Alert(successAlert);
                    bsAlert.close();
                }, 5000);
            }
            
            if (errorAlert) {
                setTimeout(function() {
                    var bsAlert = new bootstrap.Alert(errorAlert);
                    bsAlert.close();
                }, 5000);
            }

            // Auto-scroll to bottom on page load
            setTimeout(function() {
                window.scrollTo({
                    top: document.documentElement.scrollHeight,
                    behavior: 'smooth'
                });
            }, 500);

            // Auto-scroll setup for contact form
            // Helper function to scroll to bottom
            function scrollToBottom() {
                window.scrollTo({
                    top: document.documentElement.scrollHeight,
                    behavior: 'smooth'
                });
            }

            // Scroll to submit button when any form input is focused
            const formInputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea, select');
            
            if (formInputs.length > 0) {
                formInputs.forEach(function(input) {
                    input.addEventListener('focus', function() {
                        setTimeout(function() {
                            scrollToBottom();
                        }, 300);
                    });

                    input.addEventListener('click', function() {
                        setTimeout(function() {
                            scrollToBottom();
                        }, 300);
                    });
                });
            }
        });
    </script>
}